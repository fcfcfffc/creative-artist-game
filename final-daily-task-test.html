<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ç»ˆæ¯æ—¥ä»»åŠ¡æµ‹è¯•</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º -->
    <div class="user-info" id="user-info">
        <span class="user-avatar">ğŸ‘¤</span>
        <span class="user-name" id="user-name">æµ‹è¯•ç”¨æˆ·</span>
        <button class="daily-task-btn has-reward" id="daily-task-btn" title="æ¯æ—¥ä»»åŠ¡">
            <span>ğŸ§¹</span>
        </button>
    </div>

    <!-- æ‰‹æœºç«¯é’¥åŒ™æ˜¾ç¤º -->
    <div class="mobile-keys-display" id="mobile-keys-display">
        <span class="currency-icon">ğŸ—ï¸</span>
        <span class="currency-value" id="mobile-tickets">3</span>
    </div>

    <div style="padding: 20px; margin-top: 80px;">
        <h1>æœ€ç»ˆæ¯æ—¥ä»»åŠ¡æµ‹è¯•</h1>
        
        <div style="margin: 20px 0;">
            <button onclick="window.testDailyTask()" style="padding: 15px 30px; background: #667eea; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; margin: 5px;">
                å¼ºåˆ¶æ˜¾ç¤ºæ¯æ—¥ä»»åŠ¡
            </button>
            <button onclick="window.debugDailyTask()" style="padding: 15px 30px; background: #e74c3c; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; margin: 5px;">
                è°ƒè¯•ä¿¡æ¯
            </button>
            <button onclick="resetDailyTask()" style="padding: 15px 30px; background: #27ae60; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; margin: 5px;">
                é‡ç½®æ¯æ—¥ä»»åŠ¡
            </button>
        </div>
        
        <div id="debug-info" style="background: #f0f0f0; padding: 15px; border-radius: 10px; margin: 20px 0; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
            <h4>è°ƒè¯•ä¿¡æ¯:</h4>
            <div id="debug-content">ç­‰å¾…æµ‹è¯•...</div>
        </div>
    </div>

    <!-- æ¯æ—¥ä»»åŠ¡å¼¹çª— -->
    <div id="daily-task-modal" class="modal hidden">
        <div class="modal-content daily-content">
            <div class="daily-header">
                <span class="daily-icon">ğŸ§¹</span>
                <h2>æ¯æ—¥æ‰“æ‰«ä»»åŠ¡</h2>
                <p>æ•´ç†æ€ç»´ç©ºé—´ï¼Œè·å¾—ä¸°åšå¥–åŠ±ï¼</p>
            </div>
            <div class="daily-reward">
                <div class="reward-display">
                    <span class="reward-icon">ğŸ—ï¸</span>
                    <span class="reward-amount">Ã—5</span>
                </div>
                <p class="reward-text">å®Œæˆä»»åŠ¡å¯è·å¾—5æŠŠåˆ›æ„é’¥åŒ™</p>
            </div>
            <div class="daily-task-area" id="daily-task-area">
                <div class="dust-particles" id="dust-particles">
                    <!-- ç°å°˜ç²’å­å°†é€šè¿‡JSç”Ÿæˆ -->
                </div>
            </div>
            <div class="daily-progress">
                <div class="daily-progress-bar">
                    <div id="daily-progress-fill" class="daily-progress-fill"></div>
                </div>
                <span id="daily-progress-text">0/20</span>
            </div>
            <button id="skip-daily-btn" class="skip-button">è·³è¿‡</button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        function log(message) {
            const debugContent = document.getElementById('debug-content');
            const time = new Date().toLocaleTimeString();
            debugContent.innerHTML += `<div>[${time}] ${message}</div>`;
            debugContent.scrollTop = debugContent.scrollHeight;
            console.log(message);
        }

        function resetDailyTask() {
            log('é‡ç½®æ¯æ—¥ä»»åŠ¡çŠ¶æ€');
            userState.lastDailyTask = null;
            dailyTaskState.dustCleaned = 0;
            dailyTaskState.isCompleted = false;
            
            if (elements.dailyTaskBtn) {
                elements.dailyTaskBtn.classList.add('has-reward');
            }
            
            log('æ¯æ—¥ä»»åŠ¡çŠ¶æ€å·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°è§¦å‘');
        }

        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            log(args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            log('ERROR: ' + args.join(' '));
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–æ¸¸æˆ');
            
            // ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
            userState.isLoggedIn = true;
            userState.username = 'æµ‹è¯•ç”¨æˆ·';
            
            // é‡ç½®æ¯æ—¥ä»»åŠ¡çŠ¶æ€ä»¥ä¾¿æµ‹è¯•
            userState.lastDailyTask = null;
            
            log('ç”¨æˆ·çŠ¶æ€è®¾ç½®å®Œæˆï¼Œå¼€å§‹æ£€æŸ¥æ¯æ—¥ä»»åŠ¡');
            
            // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿DOMå®Œå…¨åŠ è½½
            setTimeout(() => {
                checkDailyTask();
            }, 500);
        });
    </script>
</body>
</html>