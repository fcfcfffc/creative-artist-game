<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥ä»»åŠ¡æµ‹è¯•</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div style="padding: 20px;">
        <h1>æ¯æ—¥ä»»åŠ¡åŠŸèƒ½æµ‹è¯•</h1>
        
        <div style="margin: 20px 0;">
            <button onclick="testShowModal()" style="padding: 15px 30px; background: #667eea; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px;">
                æ˜¾ç¤ºæ¯æ—¥ä»»åŠ¡å¼¹çª—
            </button>
        </div>
        
        <div style="margin: 20px 0;">
            <h3>ç”¨æˆ·ä¿¡æ¯æµ‹è¯•:</h3>
            <div class="user-info" style="position: relative; display: flex; margin: 10px 0;">
                <span class="user-avatar">ğŸ‘¤</span>
                <span class="user-name">æµ‹è¯•ç”¨æˆ·</span>
                <button class="daily-task-btn has-reward" onclick="testShowModal()">
                    <span>ğŸ§¹</span>
                </button>
            </div>
        </div>
        
        <div id="debug-info" style="background: #f0f0f0; padding: 15px; border-radius: 10px; margin: 20px 0; font-family: monospace; font-size: 12px;">
            <h4>è°ƒè¯•ä¿¡æ¯:</h4>
            <div id="debug-content">ç­‰å¾…æµ‹è¯•...</div>
        </div>
    </div>

    <!-- æ¯æ—¥ä»»åŠ¡å¼¹çª— -->
    <div id="daily-task-modal" class="modal hidden">
        <div class="modal-content daily-content">
            <div class="daily-header">
                <span class="daily-icon">ğŸ§¹</span>
                <h2>æ¯æ—¥æ‰“æ‰«ä»»åŠ¡</h2>
                <p>æ•´ç†æ€ç»´ç©ºé—´ï¼Œè·å¾—ä¸°åšå¥–åŠ±ï¼</p>
            </div>
            <div class="daily-reward">
                <div class="reward-display">
                    <span class="reward-icon">ğŸ—ï¸</span>
                    <span class="reward-amount">Ã—5</span>
                </div>
                <p class="reward-text">å®Œæˆä»»åŠ¡å¯è·å¾—5æŠŠåˆ›æ„é’¥åŒ™</p>
            </div>
            <div class="daily-task-area" id="daily-task-area">
                <div class="dust-particles" id="dust-particles">
                    <!-- ç°å°˜ç²’å­å°†é€šè¿‡JSç”Ÿæˆ -->
                </div>
            </div>
            <div class="daily-progress">
                <div class="daily-progress-bar">
                    <div id="daily-progress-fill" class="daily-progress-fill"></div>
                </div>
                <span id="daily-progress-text">0/20</span>
            </div>
            <button id="skip-daily-btn" class="skip-button">è·³è¿‡</button>
        </div>
    </div>

    <script>
        // ç®€åŒ–çš„æ¸¸æˆçŠ¶æ€
        let dailyTaskState = {
            dustCleaned: 0,
            totalDust: 15,
            isCompleted: false
        };
        
        let userState = {
            lastDailyTask: null,
            isLoggedIn: true
        };

        // DOM å…ƒç´ 
        const elements = {
            dailyTaskModal: document.getElementById('daily-task-modal'),
            dailyTaskArea: document.getElementById('daily-task-area'),
            dustParticles: document.getElementById('dust-particles'),
            dailyProgressFill: document.getElementById('daily-progress-fill'),
            dailyProgressText: document.getElementById('daily-progress-text'),
            skipDailyBtn: document.getElementById('skip-daily-btn')
        };

        function log(message) {
            const debugContent = document.getElementById('debug-content');
            const time = new Date().toLocaleTimeString();
            debugContent.innerHTML += `<div>[${time}] ${message}</div>`;
            console.log(message);
        }

        function testShowModal() {
            log('å¼€å§‹æµ‹è¯•æ˜¾ç¤ºæ¯æ—¥ä»»åŠ¡å¼¹çª—');
            
            // æ£€æŸ¥DOMå…ƒç´ 
            if (!elements.dailyTaskModal) {
                log('é”™è¯¯: æ¯æ—¥ä»»åŠ¡å¼¹çª—å…ƒç´ æœªæ‰¾åˆ°');
                return;
            }
            log('âœ“ æ¯æ—¥ä»»åŠ¡å¼¹çª—å…ƒç´ æ‰¾åˆ°');
            
            if (!elements.dustParticles) {
                log('é”™è¯¯: ç°å°˜ç²’å­å®¹å™¨æœªæ‰¾åˆ°');
                return;
            }
            log('âœ“ ç°å°˜ç²’å­å®¹å™¨æ‰¾åˆ°');
            
            // é‡ç½®ä»»åŠ¡çŠ¶æ€
            dailyTaskState.dustCleaned = 0;
            dailyTaskState.isCompleted = false;
            log('âœ“ ä»»åŠ¡çŠ¶æ€å·²é‡ç½®');
            
            // ç”Ÿæˆç°å°˜
            generateDust();
            log('âœ“ ç°å°˜å·²ç”Ÿæˆ');
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            updateDailyProgress();
            log('âœ“ è¿›åº¦å·²æ›´æ–°');
            
            // æ˜¾ç¤ºå¼¹çª—
            elements.dailyTaskModal.classList.remove('hidden');
            elements.dailyTaskModal.style.display = 'flex';
            log('âœ“ å¼¹çª—å·²æ˜¾ç¤º');
        }

        function generateDust() {
            if (!elements.dustParticles) {
                log('é”™è¯¯: æ— æ³•ç”Ÿæˆç°å°˜ï¼Œå®¹å™¨ä¸å­˜åœ¨');
                return;
            }
            
            elements.dustParticles.innerHTML = '';
            
            const isMobileDevice = window.innerWidth <= 768;
            const dustCount = isMobileDevice ? 10 : 15;
            const baseSize = isMobileDevice ? 20 : 25;
            
            log(`ç”Ÿæˆ ${dustCount} ä¸ªç°å°˜ç²’å­`);
            
            for (let i = 0; i < dustCount; i++) {
                const dust = document.createElement('div');
                dust.className = 'dust';
                dust.style.left = `${Math.random() * 80 + 10}%`;
                dust.style.top = `${Math.random() * 70 + 15}%`;
                dust.style.animationDelay = `${Math.random() * 2}s`;
                
                const size = Math.random() * 15 + baseSize;
                dust.style.width = `${size}px`;
                dust.style.height = `${size}px`;
                
                dust.style.padding = isMobileDevice ? '15px' : '10px';
                dust.style.margin = isMobileDevice ? '-15px' : '-10px';
                
                dust.addEventListener('click', () => cleanDust(dust));
                dust.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    cleanDust(dust);
                });
                
                elements.dustParticles.appendChild(dust);
            }
            
            dailyTaskState.totalDust = dustCount;
        }

        function cleanDust(dustElement) {
            if (dustElement.classList.contains('cleaned')) return;
            
            dustElement.classList.add('cleaned');
            dailyTaskState.dustCleaned++;
            
            log(`æ¸…æ‰«äº†ä¸€ä¸ªç°å°˜ï¼Œè¿›åº¦: ${dailyTaskState.dustCleaned}/${dailyTaskState.totalDust}`);
            
            updateDailyProgress();
            
            if (dailyTaskState.dustCleaned >= dailyTaskState.totalDust) {
                completeDailyTask();
            }
        }

        function updateDailyProgress() {
            const progress = (dailyTaskState.dustCleaned / dailyTaskState.totalDust) * 100;
            
            if (elements.dailyProgressFill) {
                elements.dailyProgressFill.style.width = `${progress}%`;
            }
            
            if (elements.dailyProgressText) {
                elements.dailyProgressText.textContent = `${dailyTaskState.dustCleaned}/${dailyTaskState.totalDust}`;
            }
        }

        function completeDailyTask() {
            dailyTaskState.isCompleted = true;
            log('ğŸ‰ æ¯æ—¥ä»»åŠ¡å®Œæˆï¼');
            
            setTimeout(() => {
                elements.dailyTaskModal.classList.add('hidden');
                alert('ğŸ‰ æ¯æ—¥ä»»åŠ¡å®Œæˆï¼è·å¾—5æŠŠåˆ›æ„é’¥åŒ™ï¼');
            }, 500);
        }

        // ç»‘å®šè·³è¿‡æŒ‰é’®
        if (elements.skipDailyBtn) {
            elements.skipDailyBtn.addEventListener('click', () => {
                elements.dailyTaskModal.classList.add('hidden');
                log('ç”¨æˆ·è·³è¿‡äº†æ¯æ—¥ä»»åŠ¡');
            });
        }

        // ç‚¹å‡»èƒŒæ™¯å…³é—­å¼¹çª—
        if (elements.dailyTaskModal) {
            elements.dailyTaskModal.addEventListener('click', (e) => {
                if (e.target === elements.dailyTaskModal) {
                    elements.dailyTaskModal.classList.add('hidden');
                    log('ç‚¹å‡»èƒŒæ™¯å…³é—­å¼¹çª—');
                }
            });
        }

        log('æ¯æ—¥ä»»åŠ¡æµ‹è¯•é¡µé¢å·²åŠ è½½');
    </script>
</body>
</html>