<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›é€€æµ‹è¯• - å®ç®±åŠŸèƒ½éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .test-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: rgba(76, 175, 80, 0.3); }
        .error { background: rgba(244, 67, 54, 0.3); }
        .warning { background: rgba(255, 152, 0, 0.3); }
        .info { background: rgba(33, 150, 243, 0.3); }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover { background: #45a049; }
        .test-chest {
            font-size: 80px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .test-chest:hover {
            transform: scale(1.1);
        }
        #log {
            background: rgba(0, 0, 0, 0.5);
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”„ å›é€€æµ‹è¯• - å®ç®±åŠŸèƒ½éªŒè¯</h1>
        <p>æµ‹è¯•å®ç®±ç‚¹å‡»åŠŸèƒ½æ˜¯å¦å·²ä¿®å¤</p>
        
        <div class="status info">
            <strong>ä¿®å¤å†…å®¹ï¼š</strong><br>
            âœ… ä¿®å¤äº† performGacha() å‡½æ•°ä¸­çš„ gachaBtn ç©ºå¼•ç”¨é—®é¢˜<br>
            âœ… ä¿®å¤äº† updateUI() å‡½æ•°ä¸­çš„ gachaBtn ç©ºå¼•ç”¨é—®é¢˜<br>
            âœ… é‡æ–°å¯ç”¨äº†å®ç®±ç‚¹å‡»å¼€ç®±åŠŸèƒ½
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <h3>ğŸ—ï¸ å½“å‰é’¥åŒ™: <span id="test-tickets">3</span></h3>
            <div class="test-chest" id="test-chest">ğŸ“¦</div>
            <p>ç‚¹å‡»å®ç®±æµ‹è¯•å¼€ç®±åŠŸèƒ½</p>
        </div>
        
        <div style="text-align: center;">
            <button onclick="testBasicFunctions()">æµ‹è¯•åŸºç¡€å‡½æ•°</button>
            <button onclick="testChestClick()">æµ‹è¯•å®ç®±ç‚¹å‡»</button>
            <button onclick="testPerformGacha()">æµ‹è¯•å¼€ç®±å‡½æ•°</button>
            <button onclick="resetTest()">é‡ç½®æµ‹è¯•</button>
        </div>
        
        <div id="results"></div>
        <div id="log"></div>
    </div>

    <!-- åŠ è½½ä¸»æ¸¸æˆè„šæœ¬ -->
    <script src="script.js"></script>
    
    <script>
        const results = document.getElementById('results');
        const log = document.getElementById('log');
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            log.textContent += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        // æµ‹è¯•åŸºç¡€å‡½æ•°
        function testBasicFunctions() {
            addLog('å¼€å§‹æµ‹è¯•åŸºç¡€å‡½æ•°...');
            
            const functions = [
                'initGame',
                'performGacha', 
                'updateUI',
                'resetGachaScreen',
                'switchScreen'
            ];
            
            let allPassed = true;
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    addLog(`${funcName}: âœ… å·²å®šä¹‰`);
                } else {
                    addLog(`${funcName}: âŒ æœªå®šä¹‰`);
                    allPassed = false;
                }
            });
            
            if (allPassed) {
                addResult('âœ… æ‰€æœ‰åŸºç¡€å‡½æ•°éƒ½å·²æ­£ç¡®å®šä¹‰', 'success');
            } else {
                addResult('âŒ éƒ¨åˆ†åŸºç¡€å‡½æ•°ç¼ºå¤±', 'error');
            }
        }
        
        // æµ‹è¯•å®ç®±ç‚¹å‡»
        function testChestClick() {
            addLog('æµ‹è¯•å®ç®±ç‚¹å‡»åŠŸèƒ½...');
            
            try {
                // æ¨¡æ‹Ÿå®ç®±ç‚¹å‡»
                const chest = document.getElementById('test-chest');
                if (chest) {
                    chest.click();
                    addLog('å®ç®±ç‚¹å‡»äº‹ä»¶å·²è§¦å‘');
                    addResult('âœ… å®ç®±ç‚¹å‡»æµ‹è¯•é€šè¿‡', 'success');
                } else {
                    addLog('æœªæ‰¾åˆ°æµ‹è¯•å®ç®±å…ƒç´ ');
                    addResult('âŒ æµ‹è¯•å®ç®±å…ƒç´ ç¼ºå¤±', 'error');
                }
            } catch (error) {
                addLog(`å®ç®±ç‚¹å‡»æµ‹è¯•å¤±è´¥: ${error.message}`);
                addResult('âŒ å®ç®±ç‚¹å‡»æµ‹è¯•å¤±è´¥', 'error');
            }
        }
        
        // æµ‹è¯•å¼€ç®±å‡½æ•°
        function testPerformGacha() {
            addLog('æµ‹è¯• performGacha å‡½æ•°...');
            
            try {
                if (typeof performGacha === 'function') {
                    // å¤‡ä»½åŸå§‹çŠ¶æ€
                    const originalTickets = gameState.tickets;
                    const originalOpening = gameState.isOpening;
                    
                    // ç¡®ä¿æœ‰é’¥åŒ™ä¸”ä¸åœ¨å¼€ç®±ä¸­
                    gameState.tickets = 1;
                    gameState.isOpening = false;
                    
                    // è°ƒç”¨å‡½æ•°
                    performGacha();
                    
                    addLog('performGacha å‡½æ•°è°ƒç”¨æˆåŠŸ');
                    addResult('âœ… performGacha å‡½æ•°æµ‹è¯•é€šè¿‡', 'success');
                    
                    // æ¢å¤çŠ¶æ€
                    gameState.tickets = originalTickets;
                    gameState.isOpening = originalOpening;
                } else {
                    addLog('performGacha å‡½æ•°æœªå®šä¹‰');
                    addResult('âŒ performGacha å‡½æ•°æœªå®šä¹‰', 'error');
                }
            } catch (error) {
                addLog(`performGacha æµ‹è¯•å¤±è´¥: ${error.message}`);
                addResult('âŒ performGacha å‡½æ•°æµ‹è¯•å¤±è´¥', 'error');
            }
        }
        
        // é‡ç½®æµ‹è¯•
        function resetTest() {
            results.innerHTML = '';
            log.textContent = '';
            gameState.tickets = 3;
            gameState.isOpening = false;
            document.getElementById('test-tickets').textContent = gameState.tickets;
            addLog('æµ‹è¯•å·²é‡ç½®');
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('å›é€€æµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // æ£€æŸ¥æ¸¸æˆçŠ¶æ€
            if (typeof gameState !== 'undefined') {
                addLog('gameState å·²åŠ è½½');
                document.getElementById('test-tickets').textContent = gameState.tickets;
            } else {
                addLog('gameState æœªåŠ è½½');
            }
            
            // ä¸ºæµ‹è¯•å®ç®±æ·»åŠ ç‚¹å‡»äº‹ä»¶
            const testChest = document.getElementById('test-chest');
            if (testChest) {
                testChest.addEventListener('click', function() {
                    addLog('æµ‹è¯•å®ç®±è¢«ç‚¹å‡»');
                    
                    if (gameState.tickets > 0 && !gameState.isOpening) {
                        // æ’­æ”¾åŠ¨ç”»
                        this.style.transform = 'scale(1.2)';
                        setTimeout(() => {
                            this.style.transform = '';
                        }, 200);
                        
                        addLog('æ¨¡æ‹Ÿå¼€ç®±...');
                        gameState.tickets--;
                        document.getElementById('test-tickets').textContent = gameState.tickets;
                        
                        addResult('ğŸ‰ å®ç®±ç‚¹å‡»æˆåŠŸï¼é’¥åŒ™ -1', 'success');
                    } else {
                        addLog('æ²¡æœ‰é’¥åŒ™æˆ–æ­£åœ¨å¼€ç®±ä¸­');
                        addResult('âš ï¸ æ²¡æœ‰é’¥åŒ™æˆ–æ­£åœ¨å¼€ç®±ä¸­', 'warning');
                    }
                });
            }
            
            // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
            setTimeout(() => {
                testBasicFunctions();
            }, 500);
        });
        
        // é”™è¯¯æ•è·
        window.addEventListener('error', function(e) {
            addLog(`æ•è·åˆ°é”™è¯¯: ${e.message}`);
            addResult(`âŒ å‘ç°é”™è¯¯: ${e.message}`, 'error');
        });
        
        addLog('å›é€€æµ‹è¯•è„šæœ¬å·²åˆå§‹åŒ–');
    </script>
</body>
</html>