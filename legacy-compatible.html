<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›ä½œä¸­çš„è‰ºæœ¯å®¶ - å…¼å®¹ç‰ˆæœ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .game-area {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .currency {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            font-size: 18px;
        }
        
        .canvas-area {
            background: #f0f0f0;
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .canvas-area:hover {
            background: #e8e8e8;
            border-color: #999;
        }
        
        .canvas-area.active {
            background: #e3f2fd;
            border-color: #2196f3;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .chest-area {
            text-align: center;
            padding: 40px;
        }
        
        .chest {
            font-size: 100px;
            cursor: pointer;
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        .chest:hover {
            transform: scale(1.1);
        }
        
        .chest.bounce {
            animation: bounce 0.6s ease;
        }
        
        @keyframes bounce {
            0%, 20%, 60%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-20px) scale(1.1); }
            80% { transform: translateY(-10px) scale(1.05); }
        }
        
        .collection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .artwork-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .artwork-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .artwork-icon {
            font-size: 50px;
            margin-bottom: 10px;
        }
        
        .artwork-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .rarity {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            color: white;
        }
        
        .rarity-common { background: #95a5a6; }
        .rarity-rare { background: #3498db; }
        .rarity-epic { background: #9b59b6; }
        .rarity-legendary { background: #f39c12; }
        .rarity-mythic { background: #e74c3c; }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ åˆ›ä½œä¸­çš„è‰ºæœ¯å®¶</h1>
            <p>å…¼å®¹ç‰ˆæœ¬ - æ”¯æŒæ—§ç‰ˆæµè§ˆå™¨</p>
        </div>
        
        <div class="status-bar">
            <div class="currency">
                <span>ğŸ—ï¸</span>
                <span id="tickets">3</span>
                <span>æŠŠé’¥åŒ™</span>
            </div>
            <div class="currency">
                <span>ğŸ¨</span>
                <span id="click-count">0</span>
                <span>ä¸ªåˆ›æ„</span>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('work')">ğŸ’¡ åˆ›ä½œ</button>
            <button class="tab" onclick="switchTab('gacha')">ğŸ“¦ å¼€ç®±</button>
            <button class="tab" onclick="switchTab('gallery')">ğŸ–¼ï¸ å±•å…</button>
        </div>
        
        <!-- åˆ›ä½œç•Œé¢ -->
        <div id="work-content" class="tab-content active">
            <div class="game-area">
                <h3>åˆ›æ„å·¥åŠ</h3>
                <div class="canvas-area" id="canvas" onclick="handleCanvasClick()">
                    <div style="font-size: 60px; margin-bottom: 20px;">ğŸ¨</div>
                    <h3>ç‚¹å‡»è¿™é‡Œæ¿€å‘åˆ›æ„</h3>
                    <p>æ¯100æ¬¡ç‚¹å‡»è·å¾—1æŠŠåˆ›æ„é’¥åŒ™</p>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress"></div>
                </div>
                <p>è¿›åº¦: <span id="progress-text">0/100</span></p>
            </div>
        </div>
        
        <!-- å¼€ç®±ç•Œé¢ -->
        <div id="gacha-content" class="tab-content">
            <div class="game-area">
                <div class="chest-area">
                    <h3>åˆ›æ„å®ç®±</h3>
                    <div class="chest" id="chest" onclick="openChest()">ğŸ“¦</div>
                    <p>ç‚¹å‡»å®ç®±å¼€å¯åˆ›æ„ä¹‹æ—…</p>
                    <button class="button" id="open-btn" onclick="openChest()">
                        ğŸ”“ å¼€å¯å®ç®± (æ¶ˆè€—1æŠŠé’¥åŒ™)
                    </button>
                </div>
            </div>
        </div>
        
        <!-- å±•å…ç•Œé¢ -->
        <div id="gallery-content" class="tab-content">
            <div class="game-area">
                <h3>ğŸ–¼ï¸ åˆ›æ„å±•å…</h3>
                <p>æ”¶è—: <span id="collection-count">0</span> ä»¶ä½œå“</p>
                <div class="collection" id="collection">
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 60px; margin-bottom: 20px;">ğŸ–¼ï¸</div>
                        <h3>æš‚æ— æ”¶è—</h3>
                        <p>å»å¼€ç®±è·å¾—æ‚¨çš„ç¬¬ä¸€ä¸ªåˆ›æ„ä½œå“å§ï¼</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç»“æœå¼¹çª— -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h3 id="result-title">ğŸ‰ æ­å–œè·å¾—åˆ›æ„ï¼</h3>
            <div id="result-content" style="margin: 20px 0;"></div>
            <button class="button" onclick="closeModal()">ç¡®å®š</button>
        </div>
    </div>
    
    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification"></div>

    <script>
        // ä½¿ç”¨ES5è¯­æ³•ï¼Œå…¼å®¹æ—§æµè§ˆå™¨
        
        // æ¸¸æˆçŠ¶æ€ - ä½¿ç”¨varè€Œä¸æ˜¯let/const
        var gameState = {
            tickets: 3,
            clickCount: 0,
            clickProgress: 0,
            collection: []
        };
        
        // åˆ›æ„ä½œå“æ•°æ®
        var artworks = [
            { id: 1, name: "è’™å¨œä¸½è", rarity: "mythic", icon: "ğŸ‘¸", probability: 1 },
            { id: 2, name: "æ˜Ÿå¤œ", rarity: "mythic", icon: "ğŸŒŒ", probability: 1 },
            { id: 3, name: "å‘æ—¥è‘µ", rarity: "legendary", icon: "ğŸŒ»", probability: 4 },
            { id: 4, name: "å‘å–Š", rarity: "legendary", icon: "ğŸ˜±", probability: 4 },
            { id: 5, name: "å¤§å«åƒ", rarity: "epic", icon: "ğŸ—¿", probability: 7 },
            { id: 6, name: "æ€æƒ³è€…", rarity: "epic", icon: "ğŸ¤”", probability: 7 },
            { id: 7, name: "ç»´çº³æ–¯", rarity: "epic", icon: "ğŸ’ƒ", probability: 6 },
            { id: 8, name: "è‡ªç”±å¥³ç¥", rarity: "rare", icon: "ğŸ—½", probability: 10 },
            { id: 9, name: "æ–­è‡‚ç»´çº³æ–¯", rarity: "rare", icon: "ğŸ›ï¸", probability: 10 },
            { id: 10, name: "èƒœåˆ©å¥³ç¥", rarity: "rare", icon: "ğŸ‘¼", probability: 10 },
            { id: 11, name: "æŠ½è±¡ç”»A", rarity: "common", icon: "ğŸ¨", probability: 10 },
            { id: 12, name: "æŠ½è±¡ç”»B", rarity: "common", icon: "ğŸ–¼ï¸", probability: 10 },
            { id: 13, name: "æŠ½è±¡ç”»C", rarity: "common", icon: "ğŸ–Œï¸", probability: 10 },
            { id: 14, name: "æŠ½è±¡ç”»D", rarity: "common", icon: "ğŸ­", probability: 10 }
        ];
        
        // ç¨€æœ‰åº¦æ–‡æœ¬æ˜ å°„
        var rarityText = {
            common: 'æ™®é€š',
            rare: 'ç¨€æœ‰',
            epic: 'å²è¯—',
            legendary: 'ä¼ è¯´',
            mythic: 'ç¥è¯'
        };
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            var contents = document.querySelectorAll('.tab-content');
            for (var i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
            var tabs = document.querySelectorAll('.tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName + '-content').classList.add('active');
            
            // æ¿€æ´»å¯¹åº”çš„æ ‡ç­¾æŒ‰é’®
            event.target.classList.add('active');
            
            // å¦‚æœåˆ‡æ¢åˆ°å±•å…ï¼Œæ›´æ–°æ”¶è—æ˜¾ç¤º
            if (tabName === 'gallery') {
                displayCollection();
            }
        }
        
        // ç”»å¸ƒç‚¹å‡»å¤„ç†
        function handleCanvasClick() {
            gameState.clickCount++;
            gameState.clickProgress++;
            
            // æ·»åŠ ç‚¹å‡»æ•ˆæœ
            var canvas = document.getElementById('canvas');
            canvas.classList.add('active');
            setTimeout(function() {
                canvas.classList.remove('active');
            }, 200);
            
            // æ£€æŸ¥æ˜¯å¦å®Œæˆåˆ›æ„
            if (gameState.clickProgress >= 100) {
                gameState.clickProgress = 0;
                gameState.tickets++;
                showNotification('ğŸ—ï¸ å®Œæˆäº†ä¸€ä¸ªåˆ›æ„ï¼è·å¾—1æŠŠåˆ›æ„é’¥åŒ™ï¼');
            }
            
            updateUI();
            saveGameState();
        }
        
        // å¼€ç®±å¤„ç†
        function openChest() {
            if (gameState.tickets <= 0) {
                showNotification('âŒ æ²¡æœ‰é’¥åŒ™äº†ï¼å»åˆ›ä½œè·å¾—æ›´å¤šé’¥åŒ™å§ï¼');
                return;
            }
            
            gameState.tickets--;
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            var chest = document.getElementById('chest');
            chest.classList.add('bounce');
            setTimeout(function() {
                chest.classList.remove('bounce');
            }, 600);
            
            // è·å–éšæœºä½œå“
            var artwork = getRandomArtwork();
            gameState.collection.push(artwork);
            
            // æ˜¾ç¤ºç»“æœ
            showResult(artwork);
            
            updateUI();
            saveGameState();
        }
        
        // è·å–éšæœºä½œå“
        function getRandomArtwork() {
            var random = Math.random() * 100;
            var cumulativeProbability = 0;
            
            for (var i = 0; i < artworks.length; i++) {
                cumulativeProbability += artworks[i].probability;
                if (random <= cumulativeProbability) {
                    var artwork = {};
                    // å¤åˆ¶å¯¹è±¡å±æ€§ï¼ˆå…¼å®¹æ—§æµè§ˆå™¨ï¼‰
                    for (var key in artworks[i]) {
                        artwork[key] = artworks[i][key];
                    }
                    artwork.obtainedAt = new Date().toISOString();
                    return artwork;
                }
            }
            
            // é»˜è®¤è¿”å›æœ€åä¸€ä¸ª
            var lastArtwork = artworks[artworks.length - 1];
            var artwork = {};
            for (var key in lastArtwork) {
                artwork[key] = lastArtwork[key];
            }
            artwork.obtainedAt = new Date().toISOString();
            return artwork;
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(artwork) {
            var title = 'ğŸ‰ æ­å–œè·å¾—åˆ›æ„ï¼';
            
            switch(artwork.rarity) {
                case 'mythic':
                    title = 'ğŸŒŸ ä¼ å¥‡é™ä¸´ï¼ç¥è¯çº§åˆ›æ„ï¼';
                    break;
                case 'legendary':
                    title = 'âœ¨ ä¼ è¯´çº§åˆ›æ„ï¼';
                    break;
                case 'epic':
                    title = 'ğŸ’œ å²è¯—çº§åˆ›æ„ï¼';
                    break;
                case 'rare':
                    title = 'ğŸ’™ ç¨€æœ‰åˆ›æ„ï¼';
                    break;
                default:
                    title = 'ğŸ¨ è·å¾—åˆ›æ„ä½œå“ï¼';
            }
            
            document.getElementById('result-title').textContent = title;
            document.getElementById('result-content').innerHTML = 
                '<div style="font-size: 80px; margin: 20px 0;">' + artwork.icon + '</div>' +
                '<h3>' + artwork.name + '</h3>' +
                '<span class="rarity rarity-' + artwork.rarity + '">' + rarityText[artwork.rarity] + '</span>';
            
            document.getElementById('result-modal').classList.add('show');
        }
        
        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById('result-modal').classList.remove('show');
        }
        
        // æ˜¾ç¤ºæ”¶è—
        function displayCollection() {
            var collection = document.getElementById('collection');
            
            if (gameState.collection.length === 0) {
                collection.innerHTML = 
                    '<div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #666;">' +
                    '<div style="font-size: 60px; margin-bottom: 20px;">ğŸ–¼ï¸</div>' +
                    '<h3>æš‚æ— æ”¶è—</h3>' +
                    '<p>å»å¼€ç®±è·å¾—æ‚¨çš„ç¬¬ä¸€ä¸ªåˆ›æ„ä½œå“å§ï¼</p>' +
                    '</div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < gameState.collection.length; i++) {
                var artwork = gameState.collection[i];
                html += 
                    '<div class="artwork-item">' +
                    '<div class="artwork-icon">' + artwork.icon + '</div>' +
                    '<div class="artwork-name">' + artwork.name + '</div>' +
                    '<span class="rarity rarity-' + artwork.rarity + '">' + rarityText[artwork.rarity] + '</span>' +
                    '</div>';
            }
            collection.innerHTML = html;
        }
        
        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('tickets').textContent = gameState.tickets;
            document.getElementById('click-count').textContent = gameState.clickCount;
            document.getElementById('progress-text').textContent = gameState.clickProgress + '/100';
            document.getElementById('collection-count').textContent = gameState.collection.length;
            
            // æ›´æ–°è¿›åº¦æ¡
            var progressPercent = (gameState.clickProgress / 100) * 100;
            document.getElementById('progress').style.width = progressPercent + '%';
            
            // æ›´æ–°å¼€ç®±æŒ‰é’®çŠ¶æ€
            var openBtn = document.getElementById('open-btn');
            if (gameState.tickets <= 0) {
                openBtn.disabled = true;
                openBtn.textContent = 'ğŸ”’ æ²¡æœ‰é’¥åŒ™äº†';
            } else {
                openBtn.disabled = false;
                openBtn.textContent = 'ğŸ”“ å¼€å¯å®ç®± (æ¶ˆè€—1æŠŠé’¥åŒ™)';
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            var notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(function() {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        function saveGameState() {
            try {
                if (typeof localStorage !== 'undefined') {
                    localStorage.setItem('legacyGameState', JSON.stringify(gameState));
                }
            } catch (e) {
                console.log('æ— æ³•ä¿å­˜æ¸¸æˆçŠ¶æ€:', e);
            }
        }
        
        // åŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            try {
                if (typeof localStorage !== 'undefined') {
                    var saved = localStorage.getItem('legacyGameState');
                    if (saved) {
                        var savedState = JSON.parse(saved);
                        // åˆå¹¶ä¿å­˜çš„çŠ¶æ€
                        for (var key in savedState) {
                            gameState[key] = savedState[key];
                        }
                    }
                }
            } catch (e) {
                console.log('æ— æ³•åŠ è½½æ¸¸æˆçŠ¶æ€:', e);
            }
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            console.log('åˆå§‹åŒ–å…¼å®¹ç‰ˆæœ¬æ¸¸æˆ');
            loadGameState();
            updateUI();
            showNotification('ğŸ¨ æ¬¢è¿æ¥åˆ°åˆ›ä½œä¸­çš„è‰ºæœ¯å®¶ï¼');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGame);
        } else {
            initGame();
        }
        
        // ç‚¹å‡»å¼¹çª—èƒŒæ™¯å…³é—­
        document.getElementById('result-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        console.log('å…¼å®¹ç‰ˆæœ¬æ¸¸æˆå·²åŠ è½½');
    </script>
</body>
</html>